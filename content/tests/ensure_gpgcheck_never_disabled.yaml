title: The gpgcheck option should be enabled for all DNF/YUM repos
description: '...'
blocks:
- id: collect/query_repos
  type: probe
- id: find_repos_with_gpgcheck_disabled
  title: If gpgcheck option is disabled in any section it is a finding
  type: filter
  kind: cel
  sources:
    - '@collect'
  properties:
    expression: arguments.repos.filter(r, r.content.map(section, r.content[section].gpgcheck != '1').exists(v, v))
    arguments:
      repos: '$1'
- id: sections_with_gpgcheck_disabled
  title: If gpgcheck option is disabled in any section it is a finding
  type: filter
  kind: cel
  sources:
    - 'find_repos_with_gpgcheck_disabled'
  properties:
    expression: >-
      {'result': arguments.repos.size() > 0,
      'findings': arguments.repos.map(r, 
      {'file': r.file, 
      'sections': r.content.map(section, 
      {'section': section, 'gpgcheck': r.content[section].gpgcheck}).filter(s, s.gpgcheck != '1')
      })}
    arguments:
      repos: '$1'
